# Red Line

本插件會監控 LLM 的回應。

如果回應中包含設定的關鍵字，將對該使用者進行計數並進行軟性封禁。

## 功能

- **綜合違規監控中心**: 監控並統一處理來自多個源頭的違規行為。
- **LLM 回應關鍵字監控**: 在 LLM 回應後檢查是否觸發了預設的關鍵字。
- **字數超限監控**: 監聽 `word_limit` 插件發出的字數超限違規報告並計分。
- **核心內容安全監控**: 監聽 AstrBot 核心發出的違禁詞（內容安全）違規報告並計分。
- **違規計數與攔截**: 當使用者觸發違規的次數達到閾值後，後續的訊息將有機率被攔截，實現軟性封禁。
- **自動冷卻重置**: 使用者的違規計數會在一段時間後自動清零，解除限制。
- **高度可配置**: 可自訂關鍵字、觸發閾值、攔截機率和冷卻時間。

## 使用

1.  下載 Code 為 ZIP；
2.  插件管理 - 安裝插件，選擇下載的 ZIP。

## 說明

本插件透過監聽 `on_llm_response`, `on_user_message` 和 `on_decorating_result` 三個事件，實現對使用者行為的全方位監管。

1.  **LLM 回應監控 (`on_llm_response`)**: 在每次 LLM 生成回應後，插件會檢查回應內容是否包含您設定的關鍵字。如果包含，將為該使用者增加違規計數。

2.  **事前違規攔截 (`on_decorating_result`)**: 這是本插件的核心擴展。在 AstrBot 的「結果裝飾階段」，本插件會監聽由其他模組發出的、已經被攔截的事件，並進行計分：
    -   **字數超限**: 捕捉由 `astrbot_plugin_word_limit` 插件發出的違規信號。
    -   **內容安全**: 捕捉由 AstrBot 核心的內容安全檢查器發出的違規信號（例如觸發違禁詞）。

3.  **用戶訊息攔截 (`on_user_message`)**: 在每次使用者傳送訊息時，插件會檢查其累計的違規計數。如果計數超過閾值，將根據設定的機率決定是否攔截此訊息。被攔截的訊息不會傳遞給 LLM。

透過這種方式，插件可以有效地對觸發了特定紅線的對話進行管理，同時透過冷卻機制給予使用者改過的機會。

## 注意

本插件的攔截機制是機率性的，並非每次都會觸發。所有設定均可在插件設定頁面中即時調整。
